{"version":3,"sources":["webpack:///path---posts-translation-diving-into-antd-button-75a10c4d83a3718e4de1.js","webpack:///./.cache/json/posts-translation-diving-into-antd-button.json"],"names":["webpackJsonp","425","module","exports","data","site","siteMetadata","title","subtitle","copyright","author","name","twitter","disqusShortname","url","markdownRemark","id","html","fields","tagSlugs","frontmatter","tags","date","description","excerpt","pathContext","slug"],"mappings":"AAAAA,cAAc,iBAERC,IACA,SAAUC,EAAQC,GCHxBD,EAAAC,SAAkBC,MAAQC,MAAQC,cAAgBC,MAAA,OAAAC,SAAA,0CAAAC,UAAA,yBAAAC,QAAmHC,KAAA,OAAAC,QAAA,KAA4BC,gBAAA,GAAAC,IAAA,6BAAwDC,gBAAmBC,GAAA,mIAAAC,KAAA,qreAA8xfC,QAA8LC,UAAA,gBAA2BC,aAAgBb,MAAA,iCAAAc,MAAA,QAAAC,KAAA,aAAAC,YAAA,IAA8FC,QAAA,+IAAyJC,aAAgBC,KAAA","file":"path---posts-translation-diving-into-antd-button-75a10c4d83a3718e4de1.js","sourcesContent":["webpackJsonp([199137236418975],{\n\n/***/ 425:\n/***/ (function(module, exports) {\n\n\tmodule.exports = {\"data\":{\"site\":{\"siteMetadata\":{\"title\":\"EVLE\",\"subtitle\":\"Knowledge is not consumed, it is shared\",\"copyright\":\"© All rights reserved.\",\"author\":{\"name\":\"evle\",\"twitter\":\"#\"},\"disqusShortname\":\"\",\"url\":\"https://evle.netlify.com\"}},\"markdownRemark\":{\"id\":\"/Users/evle/blog/src/pages/articles/2019-07-23---translation-diving-into-antd-button/index.md absPath of file >>> MarkdownRemark\",\"html\":\"<p>Ant Design是React生态中一个高质量的UI组件库, 本文带领大家深入了解最经典的Button在 Antd 中是如何实现的。</p>\\n<h3>handleClick</h3>\\n<p><a href=\\\"https://imgchr.com/i/eAUpbn\\\"><img src=\\\"https://s2.ax1x.com/2019/07/23/eAUpbn.md.gif\\\" alt=\\\"eAUpbn.md.gif\\\"></a></p>\\n<p>首先让我们看一下按钮的点击事件处理函数<code class=\\\"language-text\\\">handleClick</code></p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token function-variable function\\\">handleClick</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">e</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">setState</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span> clicked<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token boolean\\\">true</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token function\\\">clearTimeout</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>timeout<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>timeout <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">setTimeout</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">setState</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span> clicked<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token boolean\\\">false</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token number\\\">500</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">const</span> onClick <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>props<span class=\\\"token punctuation\\\">.</span>onClick<span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>onClick<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token function\\\">onClick</span><span class=\\\"token punctuation\\\">(</span>e<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\\n<p>那么点击了按钮后发生了什么？</p>\\n<ol>\\n<li>设置内部的状态<code class=\\\"language-text\\\">clicked</code>为<code class=\\\"language-text\\\">true</code></li>\\n<li>开启了一个定时器, 0.5秒后将状态<code class=\\\"language-text\\\">clicked</code>设置为<code class=\\\"language-text\\\">false</code>, 用来re-render。</li>\\n<li>清除之前的定时器</li>\\n<li>如果给Button传递了参数<code class=\\\"language-text\\\">onClick</code>则在事件发生时, 调用<code class=\\\"language-text\\\">onClick</code></li>\\n</ol>\\n<h3>componentWillReceiveProps</h3>\\n<p><a href=\\\"https://imgchr.com/i/eAUCEq\\\"><img src=\\\"https://s2.ax1x.com/2019/07/23/eAUCEq.md.gif\\\" alt=\\\"eAUCEq.md.gif\\\"></a></p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token function\\\">componentWillReceiveProps</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">nextProps</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">const</span> currentLoading <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>props<span class=\\\"token punctuation\\\">.</span>loading<span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">const</span> loading <span class=\\\"token operator\\\">=</span> nextProps<span class=\\\"token punctuation\\\">.</span>loading<span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>currentLoading<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token function\\\">clearTimeout</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>delayTimeout<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>loading<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>delayTimeout <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">setTimeout</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">setState</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span> loading <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token number\\\">200</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">else</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">setState</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span> loading <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\\n<p><code class=\\\"language-text\\\">componentWillReceiveProps</code>是用来当<code class=\\\"language-text\\\">props</code>变化时更新<code class=\\\"language-text\\\">state</code>的, 但可能即使<code class=\\\"language-text\\\">props</code>没有改变该生命周期函数也会被调用, 因此我们要确保\\b对比以下<code class=\\\"language-text\\\">props</code>是否真的有变化。在Antd中给Button传递<code class=\\\"language-text\\\">loading</code>属性时, Button则会渲染一个转圈的等待动画, \\b\\b当<code class=\\\"language-text\\\">this.props.loading</code>发生改变时对loading状态进行判断, 如果网络请求的回应小于200ms则不会渲染等待动画。</p>\\n<h3>componentWillUnmount</h3>\\n<p><code class=\\\"language-text\\\">componentWillUnmount</code>生命周期函数在组件将要销毁的时候被调用, 一般用于做一些清理工作比如清理定时器, 网络请求, 亦或者与其它库的交互。</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token function\\\">componentWillUnmount</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>timeout<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token function\\\">clearTimeout</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>timeout<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>delayTimeout<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token function\\\">clearTimeout</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>delayTimeout<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\\n<p>Button中使用了<code class=\\\"language-text\\\">timeout</code>和<code class=\\\"language-text\\\">delayTimeout</code>2个定时器, <code class=\\\"language-text\\\">timeout</code>用于0.5秒后\\b\\b复位\\b\\b点击状态<code class=\\\"language-text\\\">clicked</code>, <code class=\\\"language-text\\\">delayTimeout</code>用于清理延时加载loading动画的定时器。</p>\\n<h3>Component description</h3>\\n<p>Antd使用TypeScript开发, 通过interface我们可以对组件的使用进行约束, 可以帮助我们快速定位组件参数传递错误导致的Bug。\\b</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">export</span> <span class=\\\"token keyword\\\">interface</span> <span class=\\\"token class-name\\\">ButtonProps</span> <span class=\\\"token punctuation\\\">{</span>\\n  type<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">:</span> ButtonType<span class=\\\"token punctuation\\\">;</span>\\n  htmlType<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">:</span> string<span class=\\\"token punctuation\\\">;</span>\\n  icon<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">:</span> string<span class=\\\"token punctuation\\\">;</span>\\n  shape<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">:</span> ButtonShape<span class=\\\"token punctuation\\\">;</span>\\n  size<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">:</span> ButtonSize<span class=\\\"token punctuation\\\">;</span>\\n  onClick<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">:</span> React<span class=\\\"token punctuation\\\">.</span>FormEventHandler<span class=\\\"token operator\\\">&lt;</span>any<span class=\\\"token operator\\\">></span><span class=\\\"token punctuation\\\">;</span>\\n  onMouseUp<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">:</span> React<span class=\\\"token punctuation\\\">.</span>FormEventHandler<span class=\\\"token operator\\\">&lt;</span>any<span class=\\\"token operator\\\">></span><span class=\\\"token punctuation\\\">;</span>\\n  loading<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">:</span> boolean<span class=\\\"token punctuation\\\">;</span>\\n  disabled<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">:</span> boolean<span class=\\\"token punctuation\\\">;</span>\\n  style<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">:</span> React<span class=\\\"token punctuation\\\">.</span>CSSProperties<span class=\\\"token punctuation\\\">;</span>\\n  prefixCls<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">:</span> string<span class=\\\"token punctuation\\\">;</span>\\n  className<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">:</span> string<span class=\\\"token punctuation\\\">;</span>\\n  ghost<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">:</span> boolean<span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n\\n<span class=\\\"token keyword\\\">export</span> <span class=\\\"token keyword\\\">default</span> <span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">Button</span> <span class=\\\"token keyword\\\">extends</span> <span class=\\\"token class-name\\\">React<span class=\\\"token punctuation\\\">.</span>Component</span><span class=\\\"token operator\\\">&lt;</span>ButtonProps<span class=\\\"token punctuation\\\">,</span> any<span class=\\\"token operator\\\">></span> <span class=\\\"token punctuation\\\">{</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\\n<p>这似乎与<code class=\\\"language-text\\\">PropTypes</code>的检测重复了</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">export</span> <span class=\\\"token keyword\\\">default</span> <span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">Button</span> <span class=\\\"token keyword\\\">extends</span> <span class=\\\"token class-name\\\">React<span class=\\\"token punctuation\\\">.</span>Component</span><span class=\\\"token operator\\\">&lt;</span>ButtonProps<span class=\\\"token punctuation\\\">,</span> any<span class=\\\"token operator\\\">></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">static</span> propTypes <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n    type<span class=\\\"token punctuation\\\">:</span> React<span class=\\\"token punctuation\\\">.</span>PropTypes<span class=\\\"token punctuation\\\">.</span>string<span class=\\\"token punctuation\\\">,</span>\\n    shape<span class=\\\"token punctuation\\\">:</span> React<span class=\\\"token punctuation\\\">.</span>PropTypes<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">oneOf</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">[</span><span class=\\\"token string\\\">'circle'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">'circle-outline'</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span>\\n    size<span class=\\\"token punctuation\\\">:</span> React<span class=\\\"token punctuation\\\">.</span>PropTypes<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">oneOf</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">[</span><span class=\\\"token string\\\">'large'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">'default'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">'small'</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span>\\n    htmlType<span class=\\\"token punctuation\\\">:</span> React<span class=\\\"token punctuation\\\">.</span>PropTypes<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">oneOf</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">[</span><span class=\\\"token string\\\">'submit'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">'button'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">'reset'</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span>\\n    onClick<span class=\\\"token punctuation\\\">:</span> React<span class=\\\"token punctuation\\\">.</span>PropTypes<span class=\\\"token punctuation\\\">.</span>func<span class=\\\"token punctuation\\\">,</span>\\n    loading<span class=\\\"token punctuation\\\">:</span> React<span class=\\\"token punctuation\\\">.</span>PropTypes<span class=\\\"token punctuation\\\">.</span>bool<span class=\\\"token punctuation\\\">,</span>\\n    className<span class=\\\"token punctuation\\\">:</span> React<span class=\\\"token punctuation\\\">.</span>PropTypes<span class=\\\"token punctuation\\\">.</span>string<span class=\\\"token punctuation\\\">,</span>\\n    icon<span class=\\\"token punctuation\\\">:</span> React<span class=\\\"token punctuation\\\">.</span>PropTypes<span class=\\\"token punctuation\\\">.</span>string<span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span></code></pre>\\n      </div>\\n<p>原文链接: <a href=\\\"https://reactkungfu.com/2017/03/diving-into-ant-design-internals-button/\\\">Diving into ant-design internals: Button</a></p>\",\"fields\":{\"tagSlugs\":[\"/tags/antd/\"]},\"frontmatter\":{\"title\":\"深入 Ant Design Button 内部原理 (翻译)\",\"tags\":[\"Antd\"],\"date\":\"2019-07-23\",\"description\":\"\"},\"excerpt\":\"Ant Design是React生态中一个高质量的UI组件库, 本文带领大家深入了解最经典的Button在 Antd 中是如何实现的。 handleClick 首先让我们看一下按钮的点击事件处理函数 那么点击了按钮后发生了什么？ 设置内部的状态 为 开启了一个定时器, 0.…\"}},\"pathContext\":{\"slug\":\"/posts/translation-diving-into-antd-button\"}}\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// path---posts-translation-diving-into-antd-button-75a10c4d83a3718e4de1.js","module.exports = {\"data\":{\"site\":{\"siteMetadata\":{\"title\":\"EVLE\",\"subtitle\":\"Knowledge is not consumed, it is shared\",\"copyright\":\"© All rights reserved.\",\"author\":{\"name\":\"evle\",\"twitter\":\"#\"},\"disqusShortname\":\"\",\"url\":\"https://evle.netlify.com\"}},\"markdownRemark\":{\"id\":\"/Users/evle/blog/src/pages/articles/2019-07-23---translation-diving-into-antd-button/index.md absPath of file >>> MarkdownRemark\",\"html\":\"<p>Ant Design是React生态中一个高质量的UI组件库, 本文带领大家深入了解最经典的Button在 Antd 中是如何实现的。</p>\\n<h3>handleClick</h3>\\n<p><a href=\\\"https://imgchr.com/i/eAUpbn\\\"><img src=\\\"https://s2.ax1x.com/2019/07/23/eAUpbn.md.gif\\\" alt=\\\"eAUpbn.md.gif\\\"></a></p>\\n<p>首先让我们看一下按钮的点击事件处理函数<code class=\\\"language-text\\\">handleClick</code></p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token function-variable function\\\">handleClick</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">e</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">setState</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span> clicked<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token boolean\\\">true</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token function\\\">clearTimeout</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>timeout<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>timeout <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">setTimeout</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">setState</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span> clicked<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token boolean\\\">false</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token number\\\">500</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">const</span> onClick <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>props<span class=\\\"token punctuation\\\">.</span>onClick<span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>onClick<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token function\\\">onClick</span><span class=\\\"token punctuation\\\">(</span>e<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\\n<p>那么点击了按钮后发生了什么？</p>\\n<ol>\\n<li>设置内部的状态<code class=\\\"language-text\\\">clicked</code>为<code class=\\\"language-text\\\">true</code></li>\\n<li>开启了一个定时器, 0.5秒后将状态<code class=\\\"language-text\\\">clicked</code>设置为<code class=\\\"language-text\\\">false</code>, 用来re-render。</li>\\n<li>清除之前的定时器</li>\\n<li>如果给Button传递了参数<code class=\\\"language-text\\\">onClick</code>则在事件发生时, 调用<code class=\\\"language-text\\\">onClick</code></li>\\n</ol>\\n<h3>componentWillReceiveProps</h3>\\n<p><a href=\\\"https://imgchr.com/i/eAUCEq\\\"><img src=\\\"https://s2.ax1x.com/2019/07/23/eAUCEq.md.gif\\\" alt=\\\"eAUCEq.md.gif\\\"></a></p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token function\\\">componentWillReceiveProps</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">nextProps</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">const</span> currentLoading <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>props<span class=\\\"token punctuation\\\">.</span>loading<span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token keyword\\\">const</span> loading <span class=\\\"token operator\\\">=</span> nextProps<span class=\\\"token punctuation\\\">.</span>loading<span class=\\\"token punctuation\\\">;</span>\\n\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>currentLoading<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token function\\\">clearTimeout</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>delayTimeout<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>loading<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>delayTimeout <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">setTimeout</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">setState</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span> loading <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token number\\\">200</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">else</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">setState</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span> loading <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\\n<p><code class=\\\"language-text\\\">componentWillReceiveProps</code>是用来当<code class=\\\"language-text\\\">props</code>变化时更新<code class=\\\"language-text\\\">state</code>的, 但可能即使<code class=\\\"language-text\\\">props</code>没有改变该生命周期函数也会被调用, 因此我们要确保\\b对比以下<code class=\\\"language-text\\\">props</code>是否真的有变化。在Antd中给Button传递<code class=\\\"language-text\\\">loading</code>属性时, Button则会渲染一个转圈的等待动画, \\b\\b当<code class=\\\"language-text\\\">this.props.loading</code>发生改变时对loading状态进行判断, 如果网络请求的回应小于200ms则不会渲染等待动画。</p>\\n<h3>componentWillUnmount</h3>\\n<p><code class=\\\"language-text\\\">componentWillUnmount</code>生命周期函数在组件将要销毁的时候被调用, 一般用于做一些清理工作比如清理定时器, 网络请求, 亦或者与其它库的交互。</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token function\\\">componentWillUnmount</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>timeout<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token function\\\">clearTimeout</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>timeout<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>delayTimeout<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token function\\\">clearTimeout</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token keyword\\\">this</span><span class=\\\"token punctuation\\\">.</span>delayTimeout<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">;</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\\n<p>Button中使用了<code class=\\\"language-text\\\">timeout</code>和<code class=\\\"language-text\\\">delayTimeout</code>2个定时器, <code class=\\\"language-text\\\">timeout</code>用于0.5秒后\\b\\b复位\\b\\b点击状态<code class=\\\"language-text\\\">clicked</code>, <code class=\\\"language-text\\\">delayTimeout</code>用于清理延时加载loading动画的定时器。</p>\\n<h3>Component description</h3>\\n<p>Antd使用TypeScript开发, 通过interface我们可以对组件的使用进行约束, 可以帮助我们快速定位组件参数传递错误导致的Bug。\\b</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">export</span> <span class=\\\"token keyword\\\">interface</span> <span class=\\\"token class-name\\\">ButtonProps</span> <span class=\\\"token punctuation\\\">{</span>\\n  type<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">:</span> ButtonType<span class=\\\"token punctuation\\\">;</span>\\n  htmlType<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">:</span> string<span class=\\\"token punctuation\\\">;</span>\\n  icon<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">:</span> string<span class=\\\"token punctuation\\\">;</span>\\n  shape<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">:</span> ButtonShape<span class=\\\"token punctuation\\\">;</span>\\n  size<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">:</span> ButtonSize<span class=\\\"token punctuation\\\">;</span>\\n  onClick<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">:</span> React<span class=\\\"token punctuation\\\">.</span>FormEventHandler<span class=\\\"token operator\\\">&lt;</span>any<span class=\\\"token operator\\\">></span><span class=\\\"token punctuation\\\">;</span>\\n  onMouseUp<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">:</span> React<span class=\\\"token punctuation\\\">.</span>FormEventHandler<span class=\\\"token operator\\\">&lt;</span>any<span class=\\\"token operator\\\">></span><span class=\\\"token punctuation\\\">;</span>\\n  loading<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">:</span> boolean<span class=\\\"token punctuation\\\">;</span>\\n  disabled<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">:</span> boolean<span class=\\\"token punctuation\\\">;</span>\\n  style<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">:</span> React<span class=\\\"token punctuation\\\">.</span>CSSProperties<span class=\\\"token punctuation\\\">;</span>\\n  prefixCls<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">:</span> string<span class=\\\"token punctuation\\\">;</span>\\n  className<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">:</span> string<span class=\\\"token punctuation\\\">;</span>\\n  ghost<span class=\\\"token operator\\\">?</span><span class=\\\"token punctuation\\\">:</span> boolean<span class=\\\"token punctuation\\\">;</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n\\n<span class=\\\"token keyword\\\">export</span> <span class=\\\"token keyword\\\">default</span> <span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">Button</span> <span class=\\\"token keyword\\\">extends</span> <span class=\\\"token class-name\\\">React<span class=\\\"token punctuation\\\">.</span>Component</span><span class=\\\"token operator\\\">&lt;</span>ButtonProps<span class=\\\"token punctuation\\\">,</span> any<span class=\\\"token operator\\\">></span> <span class=\\\"token punctuation\\\">{</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre>\\n      </div>\\n<p>这似乎与<code class=\\\"language-text\\\">PropTypes</code>的检测重复了</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-javascript\\\"><code class=\\\"language-javascript\\\"><span class=\\\"token keyword\\\">export</span> <span class=\\\"token keyword\\\">default</span> <span class=\\\"token keyword\\\">class</span> <span class=\\\"token class-name\\\">Button</span> <span class=\\\"token keyword\\\">extends</span> <span class=\\\"token class-name\\\">React<span class=\\\"token punctuation\\\">.</span>Component</span><span class=\\\"token operator\\\">&lt;</span>ButtonProps<span class=\\\"token punctuation\\\">,</span> any<span class=\\\"token operator\\\">></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">static</span> propTypes <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n    type<span class=\\\"token punctuation\\\">:</span> React<span class=\\\"token punctuation\\\">.</span>PropTypes<span class=\\\"token punctuation\\\">.</span>string<span class=\\\"token punctuation\\\">,</span>\\n    shape<span class=\\\"token punctuation\\\">:</span> React<span class=\\\"token punctuation\\\">.</span>PropTypes<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">oneOf</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">[</span><span class=\\\"token string\\\">'circle'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">'circle-outline'</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span>\\n    size<span class=\\\"token punctuation\\\">:</span> React<span class=\\\"token punctuation\\\">.</span>PropTypes<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">oneOf</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">[</span><span class=\\\"token string\\\">'large'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">'default'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">'small'</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span>\\n    htmlType<span class=\\\"token punctuation\\\">:</span> React<span class=\\\"token punctuation\\\">.</span>PropTypes<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">oneOf</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">[</span><span class=\\\"token string\\\">'submit'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">'button'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token string\\\">'reset'</span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span>\\n    onClick<span class=\\\"token punctuation\\\">:</span> React<span class=\\\"token punctuation\\\">.</span>PropTypes<span class=\\\"token punctuation\\\">.</span>func<span class=\\\"token punctuation\\\">,</span>\\n    loading<span class=\\\"token punctuation\\\">:</span> React<span class=\\\"token punctuation\\\">.</span>PropTypes<span class=\\\"token punctuation\\\">.</span>bool<span class=\\\"token punctuation\\\">,</span>\\n    className<span class=\\\"token punctuation\\\">:</span> React<span class=\\\"token punctuation\\\">.</span>PropTypes<span class=\\\"token punctuation\\\">.</span>string<span class=\\\"token punctuation\\\">,</span>\\n    icon<span class=\\\"token punctuation\\\">:</span> React<span class=\\\"token punctuation\\\">.</span>PropTypes<span class=\\\"token punctuation\\\">.</span>string<span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">;</span></code></pre>\\n      </div>\\n<p>原文链接: <a href=\\\"https://reactkungfu.com/2017/03/diving-into-ant-design-internals-button/\\\">Diving into ant-design internals: Button</a></p>\",\"fields\":{\"tagSlugs\":[\"/tags/antd/\"]},\"frontmatter\":{\"title\":\"深入 Ant Design Button 内部原理 (翻译)\",\"tags\":[\"Antd\"],\"date\":\"2019-07-23\",\"description\":\"\"},\"excerpt\":\"Ant Design是React生态中一个高质量的UI组件库, 本文带领大家深入了解最经典的Button在 Antd 中是如何实现的。 handleClick 首先让我们看一下按钮的点击事件处理函数 那么点击了按钮后发生了什么？ 设置内部的状态 为 开启了一个定时器, 0.…\"}},\"pathContext\":{\"slug\":\"/posts/translation-diving-into-antd-button\"}}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/json-loader!./.cache/json/posts-translation-diving-into-antd-button.json\n// module id = 425\n// module chunks = 199137236418975"],"sourceRoot":""}